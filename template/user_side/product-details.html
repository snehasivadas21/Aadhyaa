{% extends 'user_side/base.html' %}
{% load static %}
{% block content %}
<style>
    .star-rating {
        display: flex;
        cursor: pointer;
    }

    .star {
        font-size: 24px;
        color: #ddd;
    }

    .star.filled {
        color: #f5c518; /* Gold color for filled stars */
    }
    .comment-form .form-group button.button-contactForm {
        background-color: #007bff; /* Your preferred button color */
        border-color: #007bff;
    }
    
    .comment-form .form-group button.button-contactForm:hover {
        background-color: #0056b3; /* Button color on hover */
        border-color: #0056b3;
    }

        /* Container to limit the zoom area */
    .zoom-container {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 300px; /* Adjust to your desired image size */
        height: auto; /* Adjust to your desired image size */
    }

    /* Main image styling */
    .zoom-container img {
        width: 100%; /* Ensure image fits the container */
        transition: transform 0.3s ease; /* Smooth zoom effect */
    }

    /* Zoom effect on hover */
    .zoom-container:hover img {
        transform: scale(1.5); /* Adjust zoom level */
    }

    
</style>
<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="{% url 'home_page' %}" rel="nofollow">Home</a>
                <span></span><a href="{% url 'shop-side' %}">Shop</a> 
                <span></span> {{ product.product_name }}
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="product-detail accordion-detail">
                        <div class="row mb-50">
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div class="detail-gallery">
                                    <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                    <!-- MAIN SLIDES -->
                                    <div class="product-image-slider" id="product-image-slider">
                                        {% if variant_images %}
                                            {% for image in variant_images %}
                                            <div class="zoom-container">
                                                <img src="{{ image.images.url }}" alt="{{ product.product_name }}" class="main-image img-fluid">
                                            </div>
                                            {% endfor %}
                                        {% elif product.thumbnail %}
                                        <div class="zoom-container">
                                            <img src="{{ product.thumbnail.url }}" alt="{{ product.product_name }}" class="main-image img-fluid">
                                        </div>
                                        {% else %}
                                        <div class="zoom-container">
                                            <img src="{% static 'images/No_Image-1024.webp' %}" alt="{{ product.product_name }}" class="main-image img-fluid">
                                        </div>
                                        {% endif %}
                                    </div>
                                    <!-- THUMBNAILS -->
                                    <div class="slider-nav-thumbnails pl-15 pr-15" id="thumbnails-slider" style="max-width: 400px; margin: auto;">
                                        {% if variant_images %}
                                            {% for image in variant_images %}
                                            <div class="thumbnail-item"><img src="{{ image.images.url }}" alt="{{ product.product_name }}" class="thumbnail-image img-thumbnail"></div>
                                            {% endfor %}
                                        {% elif product.thumbnail %}
                                            <div class="thumbnail-item"><img src="{{ product.thumbnail.url }}" alt="{{ product.product_name }}" class="thumbnail-image img-thumbnail"></div>
                                        {% else %}
                                            <div class="thumbnail-item"><img src="{% static 'images/No_Image-1024.webp' %}" alt="{{ product.product_name }}" class="thumbnail-image img-thumbnail"></div>
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- End Gallery -->
                            </div>
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div class="detail-info">
                                    <h2 class="title-detail">{{ product.product_name }}</h2>
                                    <div class="product-detail-rating">
                                        <div class="product-rate-cover text-end">
                                            <div class="star-rating-display" data-rating="{{ product.get_average_rating }}">
                                                {% with rating=product.get_average_rating|default:0 %}
                                                    <span class="star {% if rating >= 1 %}filled{% endif %}">&#9733;</span>
                                                    <span class="star {% if rating >= 2 %}filled{% endif %}">&#9733;</span>
                                                    <span class="star {% if rating >= 3 %}filled{% endif %}">&#9733;</span>
                                                    <span class="star {% if rating >= 4 %}filled{% endif %}">&#9733;</span>
                                                    <span class="star {% if rating >= 5 %}filled{% endif %}">&#9733;</span>
                                                {% endwith %}
                                            </div>
                                            <span class="font-small ml-5 text-muted">({{ product.reviews.count }} reviews)</span>
                                        </div>
                                    </div>
                                    <div class="clearfix product-price-cover">
                                        <div class="product-price primary-color float-left">
                                            <ins><span class="text-brand">₹{{ product.offer_price }}</span></ins>
                                            <ins><span class="old-price font-md ml-15"> ₹{{ product.price }}</span></ins>
                                            <span class="save-price font-md color3 ml-15">{{ product.percentage_discount }}% Off</span>
                                        </div>
                                    </div>
                                    <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                    <div class="short-desc mb-30">
                                        <p>{{ product.product_description }}</p>
                                    </div>
                                    <div class="product_sort_info font-xs mb-30">
                                        <ul>
                                            <li class="mb-10"><i class="fi-rs-crown mr-5"></i> The Purity Gurantee</li>
                                            <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 14 Day Return Policy</li>
                                            <li><i class="fi-rs-credit-card mr-5"></i> Easy and Secure Payment</li>
                                        </ul>
                                    </div>
                                    <div class="attr-detail attr-color mb-15">
                                        <strong class="mr-10">Color</strong>
                                        <ul class="list-filter color-filter">
                                            {% for variant in variants %}
                                            <li class="list-inline-item {% if selected_variant.id == variant.id %}active{% endif %}">
                                                <a href="#" class="color-select {% if selected_variant.id == variant.id %}selected{% endif %}" data-variant-id="{{ variant.id }}" data-image-urls="{% for image in variant.product_variant_images_set.all %}{{ image.images.url }}{% if not forloop.last %},{% endif %}{% endfor %}">
                                                    <span class="d-inline-block rounded-circle border border-dark position-relative" style="background-color: {{ variant.colour_code }}; width: 25px; height: 25px;">
                                                        {% if variant.id == selected_variant.id %}
                                                        <i class="fi-rs-check position-absolute top-0 start-100 translate-middle text-white" style="font-size: 12px; right: 0; top: 0;"></i>
                                                        {% endif %}
                                                    </span>
                                                </a>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                       
                                    </div>
                                    <div class="attr-detail attr-size">
                                        <strong class="mr-10">Weight</strong>
                                        <ul class="list-filter size-filter font-small" id="weight-list">
                                            {% if unique_weight %}
                                                {% for weight in unique_weight %}
                                                    <li>
                                                        <a href="#" class="weight-selector {% if weight.weight == selected_weight %}active{% endif %}" data-size="{{ weight.weight }}">
                                                            {{ weight.weight }}
                                                        </a>
                                                        
                                                        <li>
                                                            Availability:
                                                            {% if weight.variant_stock > 0 %}
                                                                <span class="in-stock text-success ml-5">{{ weight.variant_stock }} Items In Stock</span>
                                                            {% else %}
                                                                <span class="out-of-stock text-danger ml-5">Out of Stock</span>
                                                            {% endif %}
                                                        </li>
                                                    </li>
                                                {% endfor %}
                                            {% else %}
                                                <li>
                                                    <a class="weight-selector">
                                                        {{ selected_variant.weight }}
                                                    </a>
                                                    <li>
                                                        Availability:
                                                        {% if selected_variant.variant_stock > 0 %}
                                                            <span class="in-stock text-success ml-5">{{ selected_variant.variant_stock }} Items In Stock</span>
                                                        {% else %}
                                                            <span class="out-of-stock text-danger ml-5">Out of Stock</span>
                                                        {% endif %}
                                                    </li>
                                                </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                    
                                    <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                    <div class="detail-extralink">
                                        <div class="detail-qty border radius" style="display: none;">
                                            <a href="#" class="qty-down" onclick="updateQty(this, -1)"><i class="fi-rs-angle-small-down"></i></a>
                                            <span class="qty-val">1</span>
                                            <a href="#" class="qty-up" onclick="
                                                var qtySpan = this.previousElementSibling;
                                                var currentQty = parseInt(qtySpan.textContent);
                                                if (currentQty < 5) {
                                                    updateQty(this, 1);
                                                }
                                            "><i class="fi-rs-angle-small-up"></i></a>
                                        </div>
                                        <div class="product-extra-link2">
                                            {% if user.is_authenticated %}
                                                <!-- Add to Cart Button -->
                                                <button type="button" class="button button-add-to-cart">Add to Cart</button>

                                                <!-- Go to Cart Button (Initially hidden) -->
                                                <button id="go-to-cart" type="button" class="button button-go-to-cart" style="display:none;">Go to Cart</button>

                                                 <!-- Wishlist Button -->
                                                <a href="#" class="action-btn hover-up wishlist-toggle" data-url="{% url 'toggle_wishlist' %}">
                                                    <i class="fi-rs-heart" id="wishlistIcon"></i>
                                                </a>
                                            {% else %}
                                                <button type="button" class="button button-add-to-cart" id="login-to-add">Add to Cart</button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <!-- Detail Info -->
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-10 m-auto entry-main-content">

                                <h3 class="section-title style-1 mb-30 mt-30">Reviews ({{ reviews.count }})</h3>

                                <!-- Comment Form -->
                                <div class="comment-form">
                                    <h4 class="mb-15">Add a review</h4>

                                    {% if has_purchased %}
                                        <div class="row justify-content-center">
                                            <div class="col-lg-6 col-md-8">
                                                <form method="post" class="form-contact comment_form" action="{% url 'add-review' product.id %}" id="commentForm">
                                                    {% csrf_token %}
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <textarea class="form-control w-100" name="comment" id="comment" cols="30" rows="4" placeholder="Write Comment" required></textarea>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 text-center">
                                                            <div class="star-rating" id="star-rating" style="display: inline-block;">
                                                                <span class="star" data-value="1">&#9733;</span>
                                                                <span class="star" data-value="2">&#9733;</span>
                                                                <span class="star" data-value="3">&#9733;</span>
                                                                <span class="star" data-value="4">&#9733;</span>
                                                                <span class="star" data-value="5">&#9733;</span>
                                                            </div>
                                                            <input type="hidden" id="rating" name="rating" value="0" required>
                                                            <p class="text-muted mt-2">Please give a rating before submitting your review.</p>
                                                        </div>
                                                    </div>
                                                    <div class="form-group text-center">
                                                        <button type="submit" class="button button-contactForm">Submit Review</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    {% else %}
                                        <p class="text-muted">You must purchase this product before you can leave a review.</p>
                                    {% endif %}
                                </div>

                                                                
                                <!-- Comments Area -->
                                <div class="comments-area style-2">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            {% for review in reviews %}
                                            <div class="comment-list mb-4">
                                                <div class="single-comment p-3 bg-light rounded shadow-sm">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <div class="thumb text-center mr-3">
                                                            <img src="{% static 'assets/imgs/page/avatar-6.jpg' %}" alt="" class="img-thumbnail rounded-circle" style="width: 60px;">
                                                        </div>
                                                        <div>
                                                            <h6 class="mb-0"><a href="#" class="text-dark">{{ review.user.first_name }}</a></h6>
                                                            <p class="mb-0 text-muted font-italic">{{ review.user.email }}</p>
                                                            <p class="font-xxs text-muted">Member since {{ review.user.date_joined|date:"Y" }}</p>
                                                        </div>
                                                    </div>
                                                    <div class="desc">
                                                        <!-- Star Rating Display -->
                                                        <div class="star-rating-display mb-2">
                                                            {% for star in "★★★★★" %}
                                                                <span class="star {% if forloop.counter <= review.rating %}filled{% endif %}">&#9733;</span>
                                                            {% endfor %}
                                                        </div>
                                                        <p class="mb-2">{{ review.comment }}</p>
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <p class="font-xs text-muted">{{ review.created_at|date:"F j, Y" }}</p>
                                                            
                                                            {% if request.user == review.user %}
                                                            <form action="{% url 'delete-review' review.id %}" method="post" class="mb-0">
                                                                {% csrf_token %}
                                                                <button class="btn btn-danger btn-sm" type="submit" title="Delete Review">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 24 24">
                                                                        <path d="M3 6h18v2H3V6zm2 3v10c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9H5zm6 0h2v10h-2V9zm-4 0h2v10H7V9zm8 0h2v10h-2V9zM16 4l-1-1H9L8 4H5v2h14V4h-3z"/>
                                                                    </svg>
                                                                </button>
                                                            </form>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <div class="col-lg-4">
                                            <h4 class="mb-30">Customer reviews</h4>
                                        
                                            <!-- Star Rating Display -->
                                            <div class="d-flex mb-3 align-items-center">
                                                <div class="star-rating-display">
                                                    {% for star in "★★★★★" %}
                                                        <span class="star {% if forloop.counter <= product.get_average_rating %}filled{% endif %}">&#9733;</span>
                                                    {% endfor %}
                                                </div>
                                                <span class="ml-2 text-muted">{{ product.get_average_rating|floatformat:1 }}/5</span>
                                            </div>
                                        
                                            <!-- Progress Bars for Star Ratings -->
                                            {% for star, percentage in star_ratings.items %}
                                            <div class="progress mb-3" style="height: 15px;">
                                                <span class="mr-2">{{ star }} star</span>
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: {{ percentage }}%;" aria-valuenow="{{ percentage }}" aria-valuemin="0" aria-valuemax="100">{{ percentage }}%</div>
                                            </div>
                                            {% endfor %}
                                        
                                            <a href="#" class="font-xs text-muted">How are ratings calculated?</a>
                                        </div>
                                    </div>
                                    
                                </div>

                        </div>
                        <div class="row mt-60">
                            <div class="col-12">
                                <h3 class="section-title style-1 mb-30">Related products</h3>
                            </div>
                            <div class="col-12">
                                <div class="row">
                                    {% for product in related_products %}
                                        <div class="col-lg-4 col-md-4 col-sm-6 col-12 product-card-wrapper">
                                            <div class="product-cart-wrap">
                                                <div class="product-img-action-wrap">
                                                    <div class="product-img product-img-zoom">
                                                        <a href="{% url 'product-details-user' product.id %}">
                                                            {% with product.product_variant_set.first as variant %}
                                                                {% if variant and variant.product_variant_images_set.first %}
                                                                    <img class="default-img" src="{{ variant.product_variant_images_set.first.images.url }}" alt="{{ product.product_name }}">
                                                                {% elif product.thumbnail %}
                                                                    <img class="default-img" src="{{ product.thumbnail.url }}" alt="{{ product.product_name }}">
                                                                {% else %}
                                                                    <img class="default-img" src="{% static 'images/No_Image-1024.webp' %}" alt="{{ product.product_name }}">
                                                                {% endif %}
                                                            {% endwith %}
                                                        </a>
                                                    </div>
                                                </div>
                                                <div class="product-content-wrap">
                                                    <h2><a href="{% url 'product-details-user' product.id %}">{{ product.product_name }}</a></h2>
                                                    <div class="product-price">
                                                        {% if product.offer_price < product.price %}
                                                            <span class="offer-price">₹{{ product.offer_price }}</span>
                                                            <span class="old-price">₹{{ product.price }}</span>
                                                        {% else %}
                                                            <span class="offer-price">₹{{ product.price }}</span>
                                                        {% endif %}
                                                    </div>
                                                    {% if product.percentage_discount > 0 %}
                                                        <div class="product-discount">
                                                            <span>Discount: {{ product.percentage_discount }}%</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        {% empty %}
                                        <p>No Related Products Found</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Function to check if the item is already in the cart
        function updateButtonStatus() {
            var selectedColor = $('.color-select.selected').data('variant-id');
            
            if (!selectedColor) {
                return;
            }
    
            $.ajax({
                url: "{% url 'check_cart_status' %}", // Adjust this URL to your actual endpoint
                method: "GET",
                data: {
                    'variant_id': selectedColor
                },
                success: function(response) {
                    if (response.is_in_cart) {
                        $('.button-add-to-cart').hide();
                        $('.button-go-to-cart').show();
                    } else {
                        $('.button-add-to-cart').show();
                        $('.button-go-to-cart').hide();
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }
    
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                }
            }
        });
    
        $('.qty-down').on('click', function(e) {
            e.preventDefault();
            var qtyVal = $(this).siblings('.qty-val');
            var qty = parseInt(qtyVal.text());
            if (qty > 1) {
                qtyVal.text(qty - 1);
            }
        });
        
        $('.qty-up').on('click', function(e) {
            e.preventDefault();
            var qtyVal = $(this).siblings('.qty-val');
            var qty = parseInt(qtyVal.text());
            if (qty < 5) {
                qtyVal.text(qty + 1);
            }
        });
    
        $('.color-select').on('click', function(e) {
            e.preventDefault();
            $('.color-select').removeClass('selected');
            $(this).addClass('selected');
        
            var imageUrls = $(this).data('image-urls').split(',');
            var variantId = $(this).data('variant-id');
        
            // Update main image slider
            $('#product-image-slider .main-image').each(function(index, img) {
                if (index === 0) {
                    // Always show the first image
                    $(img).attr('src', imageUrls[0]);
                    $(img).show(); // Ensure it's visible
                } else if (index - 1 < imageUrls.length) {
                    // Update the rest of the images
                    $(img).attr('src', imageUrls[index - 1]);
                    $(img).show(); // Ensure it's visible
                } else {
                    $(img).attr('src', imageUrls[0]);
                }
            });
            
        
            // Update thumbnails
            $('#thumbnails-slider .thumbnail-item img').each(function(index, img) {
                if (index < imageUrls.length) {
                    $(img).attr('src', imageUrls[index]);
                    $(img).closest('.thumbnail-item').show();
                } else {
                    $(img).closest('.thumbnail-item').hide();
                }
            });
        
            // Reattach click event to new thumbnails using event delegation
            $('#thumbnails-slider').off('click').on('click', '.thumbnail-item img', function() {
                var thumbnailSrc = $(this).attr('src');
                if (thumbnailSrc) {
                    updateMainImage(thumbnailSrc);
                }
            });
    
        // Fetch and update weights for the selected variant
        $.ajax({
            url: "{% url 'get-variant-weight' %}", // Adjust this URL to your actual endpoint
            method: 'GET',
            data: {
                variant_id: variantId
            },
            success: function(response) {
                var weightList = $('#weight-list');
                weightList.empty(); // Clear existing weights

                // Process each item in the weight array
                response.weight.forEach(function(item) {
                    var weight = item.weight;
                    var stock = item.stock;
                    var stockText = stock > 0
                        ? '<span class="in-stock text-success ml-5">' + stock + ' Items In Stock</span>'
                        : '<span class="out-of-stock text-danger ml-5">Out of Stock</span>';
                    
                    weightList.append(
                        '<li>' +
                            '<a href="#" class="weight-selector" data-size="' + weight + '">' + weight + '</a>' +
                        '</li>' +
                        '<li>Availability: ' + stockText + '</li>'
                    );
                });
            },
            error: function() {
                console.error('Failed to fetch weight for the selected variant.');
            }
        });

        // Update button status based on the selected variant
        updateButtonStatus();
    })

    
        $('.button-add-to-cart').on('click', function(e) {
            e.preventDefault();
            var selectedColor = $('.color-select.selected').data('variant-id');
            var quantity = $(this).closest('.detail-extralink').find('.qty-val').text();
    
            if (!selectedColor) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Please select a color variant.'
                });
                return;
            }
    
            $.ajax({
                url: "{% url 'add-to-cart' %}",
                method: "POST",
                data: {
                    'variant_id': selectedColor,
                    'quantity': quantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.status == 'success') {
                        Swal.fire({
                            icon: 'success',
                            title: 'Added!',
                            text: 'Item added to cart.',
                            toast: true,
                            position: 'top-right',
                            showConfirmButton: false,
                            timer: 3000
                        });
                        // Update button status after adding item to cart
                        updateButtonStatus();
                        updateCounts();
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: 'Error adding item to cart.',
                            toast: true,
                            position: 'top-right',
                            showConfirmButton: false,
                            timer: 3000
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'An error occurred. Please try again.',
                        toast: true,
                        position: 'top-right',
                        showConfirmButton: false,
                        timer: 3000
                    });
                }
            });
        });
    
        $('#login-to-add').on('click', function() {
            window.location.href = "{% url 'login' %}";
        });
    
        $('#go-to-cart').on('click', function() {
            window.location.href = "{% url 'cart-view' %}";
        });
    
        // Initial call to set button status when the page loads
        updateButtonStatus();
    });
    </script>
    
</script> 
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wishlistToggle = document.querySelector('.wishlist-toggle');
        const wishlistIcon = wishlistToggle.querySelector('i');

        function showNotification(icon, title) {
            Swal.fire({
                toast: true,
                position: 'top-right',
                icon: icon,
                title: title,
                showConfirmButton: false,
                timer: 3000
            });
        }
        
        wishlistToggle.addEventListener('click', function(e) {
            e.preventDefault();
            const selectedVariant = document.querySelector('.color-select.selected');
            const wishlistIcon = document.getElementById('wishlistIcon');
            const variantId = selectedVariant ? selectedVariant.dataset.variantId : null;
            const url = this.dataset.url;

            if (!variantId) {
                console.error('No variant selected');
                showNotification('error', 'Please select a variant');
                return;
            }

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({variant_id: variantId})
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'added') {
                    wishlistIcon.classList.add('icon-red');
                    showNotification('success', 'Product added to wishlist');
                    updateCounts();
                } else if (data.status === 'removed') {
                    wishlistIcon.classList.remove('icon-red');
                    showNotification('info', 'Product removed from wishlist');
                    updateCounts();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('error', 'An error occurred');
            });
        });

        // Update wishlist icon when color is selected
        document.querySelectorAll('.color-select').forEach(colorSelect => {
            colorSelect.addEventListener('click', function() {
                const variantId = this.dataset.variantId;
                updateWishlistIcon(variantId);
            });
        });

        function updateWishlistIcon(variantId) {
            if (userWishlist.includes(parseInt(variantId))) {
                wishlistIcon.classList.add('text-danger');
            } else {
                wishlistIcon.classList.remove('text-danger');
            }
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Initialize wishlist icon for the initially selected variant
        const initiallySelectedVariant = document.querySelector('.color-select.selected');
        if (initiallySelectedVariant) {
            updateWishlistIcon(initiallySelectedVariant.dataset.variantId);
        }

        // Display any Django messages
        {% if messages %}
            const messages = [
                {% for message in messages %}
                    {
                        level: "{{ message.tags }}",
                        text: "{{ message }}"
                    },
                {% endfor %}
            ];
            messages.forEach(message => {
                Swal.fire({
                    toast: true,
                    position: 'top-right',
                    icon: message.level === 'success' ? 'success' : 'error',
                    title: message.text,
                    showConfirmButton: false,
                    timer: 3000
                });
            });
        {% endif %}
    });
</script>
<script>
    const userWishlist = {{ user_wishlist|safe }};
</script>
<!-- JavaScript for Star Rating -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('#star-rating .star');
        const ratingInput = document.getElementById('rating');
    
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                ratingInput.value = value;
    
                stars.forEach(star => {
                    if (star.getAttribute('data-value') <= value) {
                        star.classList.add('filled');
                    } else {
                        star.classList.remove('filled');
                    }
                });
            });
    
            star.addEventListener('mouseover', function() {
                const value = this.getAttribute('data-value');
    
                stars.forEach(star => {
                    if (star.getAttribute('data-value') <= value) {
                        star.classList.add('hovered');
                    } else {
                        star.classList.remove('hovered');
                    }
                });
            });
    
            star.addEventListener('mouseout', function() {
                stars.forEach(star => {
                    star.classList.remove('hovered');
                });
            });
        });
    });
    
</script>
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-zoom/1.7.21/jquery.zoom.min.js"></script> -->
<script>
    $(document).ready(function() {
        // Function to initialize zoom on the currently visible main image
        function initializeZoom() {
            // Destroy any existing zoom instances
            $('.main-image').trigger('zoom.destroy');
    
            // Apply zoom to the currently visible image
            $('.main-image:visible').zoom({
                magnify: 1.5 // Adjust the magnification level as needed
            });
        }
    
        // Initialize zoom on page load for the first visible image
        initializeZoom();
    
        // Function to update the main image
        function updateMainImage(src) {
            $('#product-image-slider .main-image').hide(); // Hide all images
            $('#product-image-slider .main-image').filter(function() {
                return $(this).attr('src') === src;
            }).show(); // Show the selected image
    
            // Reinitialize zoom on the newly visible image
            initializeZoom();
        }
    
        // Handle thumbnail click events
        $('#thumbnails-slider').on('click', '.thumbnail-item img', function() {
            var thumbnailSrc = $(this).attr('src');
            if (thumbnailSrc) {
                updateMainImage(thumbnailSrc);
            }
        });
    
        // Handle color variant selection
        $('.color-select').on('click', function() {
            var imageUrls = $(this).data('image-urls').split(',');
            updateMainImage(imageUrls[0]); // Set the first image of the selected color variant
        });
    });
    
</script>

{% endblock %}